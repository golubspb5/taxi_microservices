# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é Taxi Grid Service (Windows/Docker)

–≠—Ç–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É —Å–µ—Ä–≤–∏—Å–∞, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–¥ Windows –∏ Docker Desktop. –í –ø—Ä–æ–µ–∫—Ç–µ —É–¥–∞–ª–µ–Ω Alembic, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
2. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
3. [–ó–∞–ø—É—Å–∫ Matching Service](#–∑–∞–ø—É—Å–∫-matching-service)
4. [–°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](#—Å—Ü–µ–Ω–∞—Ä–∏–∏-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
5. [–ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#–Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
6. [–û—Ç–ª–∞–¥–∫–∞ –∏ –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã](#–æ—Ç–ª–∞–¥–∫–∞-–∏-–ø–æ–ª–µ–∑–Ω—ã–µ-–∫–æ–º–∞–Ω–¥—ã)

---

## üîß –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **Docker Desktop** (–∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç).
- **Python 3.11+** (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤).
- **Git Bash** –∏–ª–∏ PowerShell.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
–î–ª—è —Ä–∞–±–æ—Ç—ã —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –Ω–∞ Windows –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

```bash
# –í—ã–ø–æ–ª–Ω—è—Ç—å –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
python -m pip install httpx redis uuid
```

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –û—á–∏—Å—Ç–∫–∞ –∏ –∑–∞–ø—É—Å–∫
–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º "—á–∏—Å—Ç—ã–π" —Å—Ç–∞—Ä—Ç, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

```bash
# 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –¥–∞–Ω–Ω—ã–µ –ë–î
docker-compose down -v

# 2. –°–æ–±–∏—Ä–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º (–ë–î —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
docker-compose up -d --build

# 3. –ñ–¥–µ–º 15-20 —Å–µ–∫—É–Ω–¥, –ø–æ–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è Postgres –∏ API
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã. –ï—Å–ª–∏ Nginx –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å—Ç—É—á–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (127.0.0.1:8000).

```bash
python scripts/test_endpoints.py
```
*–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –°–ø–∏—Å–æ–∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —Å –∑–µ–ª–µ–Ω—ã–º–∏ –≥–∞–ª–æ—á–∫–∞–º–∏ ‚úÖ.*

---

## üöó –ó–∞–ø—É—Å–∫ Matching Service

–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ –∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –≤–æ–¥–∏—Ç–µ–ª–µ–π –Ω–∞ –∑–∞–∫–∞–∑—ã. –ë–µ–∑ –Ω–µ–≥–æ –∑–∞–∫–∞–∑—ã –±—É–¥—É—Ç –≤–∏—Å–µ—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ `pending`.

**–í–∞–∂–Ω–æ:** –ó–∞–ø—É—Å–∫–∞—Ç—å –Ω—É–∂–Ω–æ –≤ **–æ—Ç–¥–µ–ª—å–Ω–æ–º –æ–∫–Ω–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞** –∏ –¥–µ—Ä–∂–∞—Ç—å –µ–≥–æ –æ—Ç–∫—Ä—ã—Ç—ã–º.

```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –∫–∞–∫ –º–æ–¥—É–ª—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ API
docker-compose exec api python -m src.run_matching_service
```

*–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:*
```text
INFO:src.services.matching_service:DriverMatchingService –∑–∞–ø—É—â–µ–Ω —Å –¥–≤—É–º—è –≤–æ—Ä–∫–µ—Ä–∞–º–∏.
INFO:src.services.matching_service:–°–ª—É—à–∞—Ç–µ–ª—å –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –∑–∞–ø—É—â–µ–Ω...
```

---

## üß™ –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –¢–µ—Å—Ç –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –ª–æ–≥–∏–Ω –∏ –∑–∞—â–∏—Ç—É —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤. –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π email, –ø–æ—ç—Ç–æ–º—É –µ–≥–æ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ.

```bash
python scripts/test_auth.py
```

### 2. –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–∫–∞–∑–∞ (Quick Test)
–°–∏–º—É–ª–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –∂–∏–∑–Ω—å:
1. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è –∏ –≤—ã–≤–æ–¥–∏—Ç –µ–≥–æ –Ω–∞ –ª–∏–Ω–∏—é.
2. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–∞—Å—Å–∞–∂–∏—Ä–∞.
3. –°–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑.
4. –ñ–¥–µ—Ç, –ø–æ–∫–∞ Matching Service –Ω–∞–π–¥–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è.
5. –í–æ–¥–∏—Ç–µ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–∫–∞–∑.

```bash
bash scripts/quick_test.sh
```

**–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –≤—Ç–æ—Ä–æ–µ –æ–∫–Ω–æ (Matching Service):** —Ç–∞–º –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–±–µ–≥–∞—Ç—å –ª–æ–≥–∏ –æ –ø–æ–∏—Å–∫–µ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –≤–æ–¥–∏—Ç–µ–ª—è.

---

## üìä –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É (Heartbeat-–∑–∞–ø—Ä–æ—Å—ã –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞–ø—Ä—è–º—É—é –≤ Redis).

**–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Matching Service –∑–∞–ø—É—â–µ–Ω –≤–æ –≤—Ç–æ—Ä–æ–º –æ–∫–Ω–µ.

```bash
python scripts/load_test.py
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:**
- –°–æ–∑–¥–∞–Ω–∏–µ 100 –≤–æ–¥–∏—Ç–µ–ª–µ–π.
- **RPS (Requests Per Second):** > 50 (–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ).
- –õ–æ–≥–∏ Matching Service –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–∞—Å—Å–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–∫–∞–∑–æ–≤ –∏ —Ä–∞–±–æ—Ç—É —Ç–∞–π–º–∞—É—Ç–æ–≤ (—Å–Ω—è—Ç–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –µ—Å–ª–∏ –≤–æ–¥–∏—Ç–µ–ª—å –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª).

---

## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
–ß—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∑–∞–∫–∞–∑—ã —Ä–µ–∞–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:

```bash
docker-compose exec db psql -U taxi_user -d taxi_db -c "SELECT count(*) FROM rides;"
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# –õ–æ–≥–∏ API (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫)
docker-compose logs --tail=50 api

# –õ–æ–≥–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose logs --tail=50 db
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API (Swagger)
–î–æ—Å—Ç—É–ø–Ω–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ –∞–¥—Ä–µ—Å—É:
[http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx
–ï—Å–ª–∏ API —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 502 –æ—à–∏–±–∫—É –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ localhost:80:

```bash
docker-compose restart nginx
```

---

## üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Matching Service (Ctrl+C –≤–æ –≤—Ç–æ—Ä–æ–º –æ–∫–Ω–µ)

# 2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down
```